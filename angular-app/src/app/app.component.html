<div class="container">
    <h1>AstroKiddo: Teacher Deck Builder</h1>
    <div class="sub">Generate a 5-slide mini-lesson from NASA media and export to HTML/PDF.</div>

    <div class="panel">
        <div class="row">
            <form *ngIf="form" [formGroup]="form">
                <input placeholder="Topic" type="text" formControlName="topic">
                <input placeholder="Grade (e.g., 6-8)" type="text" formControlName="gradeLevel">
                <select type="text" formControlName="locale">
                    <option value="en">English</option>
                </select>
            </form>
            <button (click)="generate()" [disabled]="loading">{{ loading ? 'Generating...' : 'Generate' }}</button>
        </div>
        <div *ngIf="error" class="warn">{{ error }}</div>
    </div>

    <div *ngIf="deck" class="deck">
        <div class="panel deck-meta">
            <div class="meta-block">
                <h2 class="meta-title">{{ deck.topic }}</h2>
                <div class="meta-line">Deck ID: {{ deck.id }}</div>
                <div class="meta-line">Created: {{ deck.createdAt | date: 'medium' }}</div>
                <div class="meta-line" *ngIf="deck.enrichment?._meta?.model">Model: {{ deck.enrichment._meta.model }}</div>
            </div>
            <div class="meta-actions">
                <a class="btn" (click)="exportHtml()">⬇ Export HTML</a>
                <a class="btn" (click)="exportPdf()">⬇ Export PDF</a>
            </div>
        </div>

        <ng-container *ngIf="deck.enrichment as enrich">
            <div class="panel enrichment" *ngIf="hasEnrichment(enrich)">
                <h2>Enrichment Highlights</h2>
                <div class="enrichment-grid">
                    <section class="enrichment-section" *ngIf="enrich.hook">
                        <h3>Hook</h3>
                        <p>{{ enrich.hook }}</p>
                    </section>
                    <section class="enrichment-section" *ngIf="enrich.simple_explanation">
                        <h3>Simple Explanation</h3>
                        <p>{{ enrich.simple_explanation }}</p>
                    </section>
                    <section class="enrichment-section" *ngIf="enrich.why_it_matters">
                        <h3>Why It Matters</h3>
                        <p>{{ enrich.why_it_matters }}</p>
                    </section>
                    <section class="enrichment-section" *ngIf="enrich.class_question">
                        <h3>Class Question</h3>
                        <p>{{ enrich.class_question }}</p>
                    </section>
                    <section class="enrichment-section" *ngIf="enrich.fun_fact">
                        <h3>Fun Fact</h3>
                        <p>{{ enrich.fun_fact }}</p>
                    </section>
                </div>

                <div class="enrichment-vocabulary" *ngIf="enrich.vocabulary?.length">
                    <h3>Vocabulary</h3>
                    <ul class="vocab-list">
                        <li class="vocab-item" *ngFor="let item of enrich.vocabulary">
                            <div class="vocab-term">{{ item.term }}</div>
                            <div class="vocab-definition">{{ item.definition }}</div>
                        </li>
                    </ul>
                </div>

                <div class="enrichment-footer" *ngIf="enrich.attribution">
                    Attribution: {{ enrich.attribution }}
                </div>
            </div>
        </ng-container>

        <div class="cards">
            <div class="card" *ngFor="let s of deck.slides">
                <div class="badge">{{ s.type }}</div>
                <h3>{{ s.title }}</h3>
                <img *ngIf="s.imageUrl" [src]="s.imageUrl" alt="">
                <p>{{ s.text }}</p>
                <div class="badge" *ngIf="s.attribution">© {{ s.attribution }}</div>
            </div>
        </div>
    </div>
</div>
